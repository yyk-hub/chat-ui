<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CEO Shop</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta property="pi:app" content='{"name":"CEO Shop","description":"Premium health and wellness products","image":"https://ceo-9xi.pages.dev/img/logo.jpg"}'>
  
  <style>
    :root{
      --bg:#f4ecd6;
      --accent:#996600;
      --card:#fffdf8;
      --muted:#5b4636;
      --btn:#14b47e;
      --card-radius:14px;
      --container-max:800px;
      --header-h:48px;
    }

    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      font-family:"Segoe UI", Arial, sans-serif;
      color:#3b2f2f;
    }

    /* Fixed header (frozen) ‚Äî always visible while products scroll */
    .header{
      position:fixed;        /* frozen */
      top:0;
      left:0;
      right:0;
      z-index:1000;
      background:var(--bg);
      padding:6px 0;
      border-bottom:2px solid #d1c4a1;
      display:flex;
      align-items:center;
      justify-content:center;
      height:var(--header-h);
      box-sizing:border-box;
      -webkit-backdrop-filter: blur(2px);
      backdrop-filter: blur(2px);
      box-shadow: 0 1px 4px rgba(0,0,0,0.06);
    }

    /* Make room for the fixed header so content doesn't hide behind it */
    body { padding-top: var(--header-h); }

    .header .home-btn,
    .header .cart-btn{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      background:var(--accent);
      color:#fff;
      border:0;
      padding:6px 10px;
      border-radius:8px;
      text-decoration:none;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size:14px;
    }
    .header .home-btn{ left:12px; }
    .header .cart-btn{ right:12px; }

    .header-title{
      margin:0;
      color:var(--accent);
      font-size:16px;
      font-weight:700;
      display:flex;
      align-items:center;
      gap:8px;
    }

    /* Main container centered and constrained */
    .container{
      max-width:var(--container-max);
      margin:20px auto;
      padding:0 20px 20px;
      box-sizing:border-box;
    }

    .category{
      margin-bottom:8px; /* small gap; the header itself has spacing */
    }

    /* Make category heading sticky INSIDE the scrollable product-list */
    .category h3{
      margin:0;
      position:sticky;
      top:0; /* sticks to the top of the scroll container (#product-list) */
      z-index:6;
      background: linear-gradient(180deg, rgba(244,236,214,0.98), rgba(244,236,214,0.95)); /* slight gradient so it separates from products */
      color:var(--accent);
      font-size:16px;
      padding:8px 0;
      border-bottom:1px solid #e6dcc0;
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
    }

    .product{
      background:var(--card);
      border-radius:var(--card-radius);
      padding:12px;
      margin:10px 0;
      border:1px solid #e0d5bb;
      box-sizing:border-box;
    }

    .product-content{
      display:flex;
      gap:14px;
    }

    .product img{
      width:160px;
      height:auto;
      max-height: 180px;
      object-fit: contain;
      border-radius: 10px;
      border: 1px solid #ccc;
      display: block;
      cursor: pointer;
      flex-shrink:0;
      background: #fff;
    }

    .product h4{
      margin:0 0 8px 0;
      color:var(--accent);
      font-size:15px;
    }
    
  #toast {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(255, 255, 255, 0.5);
  color: #323232;
  padding: 10px 16px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease, transform 0.3s ease;
  z-index: 9999;
}

#toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(-4px);
}
    .product p{
      margin:6px 0;
      color:var(--muted);
      line-height:1.3;
      font-size:14px;
    }

    .product-meta{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:8px;
    }

    .btn{
      background:var(--btn);
      color:#fff;
      border:0;
      padding:8px 12px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      font-size:14px;
    }
    .btn:disabled{
      background:#bbb;
      cursor:not-allowed;
    }

    /* Make the product list area scroll inside the viewport while header stays fixed */
    #product-list {
      /* height is viewport minus header and a small bottom gap */
      max-height: calc(100vh - var(--header-h) - 24px);
      overflow-y: auto;
      padding-right: 8px; /* room for scrollbar */
      padding-top: 6px;   /* space so first category header sits nicely */
      box-sizing: border-box;
      -webkit-overflow-scrolling: touch;
    }
    /* nicer thin scrollbar on WebKit */
    #product-list::-webkit-scrollbar { width:10px; }
    #product-list::-webkit-scrollbar-thumb { background: rgba(91,70,54,0.25); border-radius:8px; }

    /* Small screens: stack image above text (single column) */
    @media (max-width:640px){
      .container{ padding:0 12px 12px; margin:12px auto; }
      .product-content{ flex-direction: column; gap: 12px; }
      .product img{ width:100%; height:auto; max-height:300px; object-fit: contain; background: #fff;}
      .product-info{width: 100%;}
      #product-list { max-height: calc(100vh - var(--header-h) - 16px); }
      .category h3 { top: 0; padding:10px 0; }

      /* Stack product meta vertically and center items on small screens
         so the "Add to Cart" button appears centered under the product info. */
      .product-meta{
        flex-direction: row;
        justify-content: flex-start;
        gap: 12px;
        flex-wrap: nowrap;
        margin-bottom: 8px; /* add space beffore button */
      }
      .product-meta > span{ white-space: nowrap;
       }
      
     /* Full width button for easier tapping on mobile */
      .btn{
        width: 100%;
        padding:12px 16px;
        margin-bottom: 8px; /* add space beffore button */
      }
      }
  </style>
</head>
<body>
  <div class="header" role="banner">
  <a href="index.html" class="home-btn" aria-label="Home">üè† Home</a>
  <h2 class="header-title">‚òï CEO Shop</h2>
  <a href="cart.html" class="cart-btn" aria-label="Cart">üõíCart (<span id="cart-count">0</span>)</a>
  </div>
  
  <div id="toast" aria-live="polite" aria-atomic="true"></div>
  
  <main class="container" id="main">
    <!-- product-list is a scrollable region; header stays frozen while products scroll -->
    <div id="product-list" aria-live="polite"></div>
  </main>

  <script>
  function showToast(message, duration = 2200) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.classList.add('show');

  setTimeout(() => {
    toast.classList.remove('show');
  }, duration);
  }
    function updateCartCount(){
      const cart = JSON.parse(localStorage.getItem('cartItems')||'[]');
      const qty = cart.reduce((s,i)=> s + (i.qty||0), 0);
      const el = document.getElementById('cart-count');
      if(el) el.textContent = qty;
    }

    function addToCart(id, name, price, weight){
      let cart = JSON.parse(localStorage.getItem('cartItems')||'[]');
      const found = cart.find(it => it.id === id);
      if(found) found.qty = (found.qty || 0) + 1;
      else cart.push({ id, name, price, weight, qty: 1 });
      localStorage.setItem('cartItems', JSON.stringify(cart));
      updateCartCount();
      showToast(`‚úÖ Added "${name}" to cart`);
    }
    async function loadProducts(){
      try{
        const res = await fetch('/api/products');
        if(!res.ok) throw new Error('Network response not ok');
        const products = await res.json();
        const productList = document.getElementById('product-list');
        productList.innerHTML = '';

        const categories = [...new Set(products.map(p=>p.category))];

        categories.forEach(cat => {
          const section = document.createElement('section');
          section.className = 'category';
          const header = document.createElement('h3');
          header.textContent = cat;
          section.appendChild(header);

          products.filter(p => p.category === cat && p.stock > 0)
            .forEach(p => {
              const prod = document.createElement('article');
              prod.className = 'product';
              const imgSrc = p.image_url ? p.image_url.replace('.png', '.jpg') : '';

              prod.innerHTML = `
                <div class="product-content" id="${p.prod_id}">
                  <a href="menu.html#${p.prod_id}" aria-label="Open menu for ${escapeHtml(p.prod_name)}">
                    <img src="${imgSrc}" alt="${escapeHtml(p.prod_name)}">
                  </a>
                  <div class="product-info">
                    <h4>${escapeHtml(p.prod_name)}</h4>
                    <p>${escapeHtml(p.description || '')}</p>
                    <div class="product-meta">
                      <span><strong>Price:</strong> RM ${Number(p.price).toFixed(2)}</span>
                      <span><strong>Stock:</strong> ${p.stock}</span>
                      </div>
                      <button class="btn" ${p.stock<=0?'disabled':''} 
                      onclick="addToCart('${p.prod_id}','${escapeAttr(p.prod_name)}',${Number(p.price)},${Number(p.weight)})"> ${p.stock > 0 ? 'Add to Cart' : 'Out of Stock'}</button>
                  </div>
                </div>
              `;
              section.appendChild(prod);
            });

          productList.appendChild(section);
        });
        
// After products are loaded into the page
setTimeout(() => {
  const hash = window.location.hash;
  if (hash) {
    const target = document.querySelector(hash);
    if (target) {
      target.scrollIntoView({ behavior: "smooth", block: "center" });
    }
  }
}, 600);

      }catch(err){
        console.error('Failed to load products', err);
        const productList = document.getElementById('product-list');
        productList.innerHTML = '<p style="color:#a00">Failed to load products.</p>';
      }
    }

    function escapeHtml(s){
      if(!s && s !== 0) return '';
      return String(s)
        .replace(/&/g,'&amp;')
        .replace(/</g,'&lt;')
        .replace(/>/g,'&gt;')
        .replace(/"/g,'&quot;')
        .replace(/'/g,'&#39;');
    }
    function escapeAttr(s){
      if(!s && s !== 0) return '';
      return String(s).replace(/'/g,"\\'");
    }

    // init
    updateCartCount();
    loadProducts();
  </script>
</body>
</html>
