<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cart - CEO Products</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background:#f4ecd6; font-family:Segoe UI, Arial, sans-serif; margin:0; }
    .container { padding:20px; max-width:800px; margin:auto; }
    .header { 
      display:flex; 
      justify-content:space-between; 
      align-items:center; 
      background:#fffbe6;
      padding:10px 20px;
      border-bottom:2px solid #ddd;
    }
    .header-title { 
      margin:0; 
      color:#996600; 
      text-align:center;
      flex:1;
    }
    .home-btn, .cart-btn { 
      background:#996600; 
      color:#fff; 
      text-decoration:none; 
      padding:8px 16px; 
      border-radius:8px; 
      font-weight:bold; 
    }
    .cart-btn { background:#14b47e; }
    .cart-btn span { color:#fff; }

    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border-bottom:1px solid #ccc; padding:10px; text-align:left; }
    th { background:#fffbe6; color:#996600; }
    td button { background:#14b47e; border:none; color:white; padding:4px 10px; border-radius:6px; cursor:pointer; }
    td button:disabled { background:gray; cursor:not-allowed; }
    .total { text-align:right; font-size:18px; margin-top:20px; color:#996600; }
    .checkout-btn { background:#996600; color:white; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; margin-top:10px; float:right; }
    .chat-btn { 
      display:block; 
      margin-top:80px; 
      text-align:center; 
      text-decoration:none; 
      background:#14b47e; 
      color:#fff; 
      padding:12px 24px; 
      border-radius:10px; 
      font-weight:bold; 
      width:fit-content;
      margin-left:auto;
      margin-right:auto;
    }
  </style>
</head>
<body>
  <div class="header">
    <a href="index.html" class="home-btn">Home</a>
    <h2 class="header-title">üõí Cart</h2>
    <a href="cart.html" class="cart-btn">Cart (<span id="cart-count">0</span>)</a>
  </div>

  <div class="container">
    <div id="cart-items"></div>
    <div class="total" id="total"></div>
    <button class="checkout-btn" onclick="checkout()">Checkout</button>

    <a href="chat.html" class="chat-btn">üí¨ Back to Chat</a>
  </div>

  <script src="js/cart-utils.js"></script>
  <script>
    function renderCart() {
      let cart = JSON.parse(localStorage.getItem("cartItems")) || [];
      let cartDiv = document.getElementById("cart-items");
      let totalDiv = document.getElementById("total");

      if (cart.length === 0) {
        cartDiv.innerHTML = "<p>Your cart is empty.</p>";
        totalDiv.innerHTML = "";
        updateCartCount();
        return;
      }

      let html = `
        <table>
          <tr><th>Product</th><th>Price</th><th>Qty</th><th>Subtotal</th><th></th></tr>
      `;

      let total = 0;
      cart.forEach(item => {
        let sub = item.price * item.qty;
        total += sub;
        html += `
          <tr>
            <td>${item.name}</td>
            <td>RM ${item.price}</td>
            <td>
              <button onclick="changeQty(${item.id}, -1)">-</button>
              ${item.qty}
              <button onclick="changeQty(${item.id}, 1)">+</button>
            </td>
            <td>RM ${sub}</td>
            <td><button onclick="removeItem(${item.id})">üóëÔ∏è</button></td>
          </tr>
        `;
      });

      html += "</table>";
      cartDiv.innerHTML = html;
      totalDiv.innerHTML = `<b>Total: RM ${total}</b>`;
      updateCartCount();
    }

    function changeQty(id, delta) {
      let cart = JSON.parse(localStorage.getItem("cartItems")) || [];
      let products = JSON.parse(localStorage.getItem("products")) || [];
      let item = cart.find(i => i.id === id);
      let product = products.find(p => p.id === id);
      if (!item || !product) return;

      if (delta > 0 && product.stock <= 0) {
        alert("Out of stock!");
        return;
      }

      item.qty += delta;
      if (item.qty <= 0) {
        cart = cart.filter(i => i.id !== id);
      } else {
        product.stock -= delta;
      }

      localStorage.setItem("cartItems", JSON.stringify(cart));
      localStorage.setItem("products", JSON.stringify(products));
      renderCart();
    }

    function removeItem(id) {
      let cart = JSON.parse(localStorage.getItem("cartItems")) || [];
      cart = cart.filter(i => i.id !== id);
      localStorage.setItem("cartItems", JSON.stringify(cart));
      renderCart();
    }

    function checkout() {
      let cart = JSON.parse(localStorage.getItem("cartItems")) || [];
      if (cart.length === 0) {
        alert("Cart is empty!");
        return;
      }

      alert("Thank you for your purchase!");
      localStorage.removeItem("cartItems");
      renderCart();
    }

    renderCart();
  </script>
</body>
</html>
